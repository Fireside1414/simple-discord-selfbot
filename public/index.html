

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Discord SelfBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #e2e8f0; --accent: #3b82f6; --sidebar: #020617; --danger: #ef4444; --success: #22c55e; --warning: #f59e0b; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* --- LAYOUT --- */
        .sidebar { width: 280px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid #334155; flex-shrink: 0; z-index: 50; transition: transform 0.3s ease; }
        .sidebar-header { padding: 20px; font-weight: 800; font-size: 1.2rem; text-align: center; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; letter-spacing: 1px; color: var(--accent); }
        .account-list { flex: 1; overflow-y: auto; padding: 10px; }
        .main { flex: 1; padding: 20px; overflow-y: auto; position: relative; width: 100%; display: flex; flex-direction: column; }
        .container { max-width: 1100px; margin: 0 auto; width: 100%; padding-bottom: 80px; }

        /* --- COMPONENTS --- */
        .account-item { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; cursor: pointer; border-radius: 10px; transition: 0.2s; border: 1px solid transparent; background: rgba(255,255,255,0.03); }
        .account-item:hover { background: #334155; transform: translateX(3px); }
        .account-item.active { background: #1e293b; border-color: var(--accent); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2); }
        .acc-avatar { width: 42px; height: 42px; border-radius: 50%; background: #475569; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; overflow: hidden; color: white; }
        .acc-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .acc-info { display: flex; flex-direction: column; overflow: hidden; }
        .acc-name { font-weight: 700; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .acc-status { font-size: 0.75rem; color: #94a3b8; display: flex; align-items: center; gap: 6px; margin-top: 2px; }
        
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .dot-green { background: var(--success); box-shadow: 0 0 8px var(--success); } 
        .dot-red { background: var(--danger); }

        .sidebar-btn { margin: 5px 10px; padding: 12px; border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; display: block; width: calc(100% - 20px); text-align: center; transition: 0.2s; font-size: 0.9rem; }
        .btn-add { background: var(--accent); } .btn-add:hover { background: #2563eb; }
        .btn-settings { background: #334155; } .btn-settings:hover { background: #475569; }
        .btn-logout { background: transparent; border: 1px solid var(--danger); color: var(--danger); margin-top: auto; margin-bottom: 20px; }
        .btn-logout:hover { background: var(--danger); color: white; }

        /* --- FORMS & INPUTS --- */
        .card { background: var(--card); padding: 25px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #334155; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        input, select, textarea { width: 100%; padding: 12px; background: #020617; border: 1px solid #334155; color: white; border-radius: 8px; box-sizing: border-box; font-size: 0.95rem; margin-bottom: 8px; transition: border-color 0.2s; }
        input:focus, select:focus, textarea:focus { border-color: var(--accent); outline: none; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #cbd5e1; font-size: 0.9rem; margin-top: 12px; }
        
        .switch-row { display: flex; align-items: center; justify-content: space-between; background: #0f172a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border: 1px solid #334155; }
        input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--success); margin: 0; cursor: pointer; }

        /* --- BUTTONS --- */
        .btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-size: 0.9rem; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--accent); width: 100%; margin-top: 15px; padding: 14px; font-size: 1rem; }
        .btn-danger { background: var(--danger); }
        .btn-info { background: #0ea5e9; }
        .btn-secondary { background: #475569; }

        /* --- TABS --- */
        .nav { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .nav::-webkit-scrollbar { display: none; }
        .nav-btn { background: var(--card); border: 1px solid #334155; color: #94a3b8; padding: 12px 24px; cursor: pointer; border-radius: 10px; font-weight: bold; white-space: nowrap; transition: 0.2s; }
        .nav-btn:hover { background: #334155; color: white; }
        .nav-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }

        .section { display: none; animation: fadeIn 0.3s ease; } .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HEADER AREA --- */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; gap: 15px; flex-wrap: wrap; }
        .power-btn { padding: 10px 24px; border-radius: 30px; border: 1px solid transparent; font-weight: 800; cursor: pointer; transition: 0.2s; min-width: 120px; }
        .power-on { background: rgba(34, 197, 94, 0.1); color: var(--success); border-color: var(--success); }
        .power-on:hover { background: var(--success); color: white; }
        .power-off { background: rgba(239, 68, 68, 0.1); color: var(--danger); border-color: var(--danger); }
        .power-off:hover { background: var(--danger); color: white; }

        /* --- LOGGING TABLE --- */
        .log-container { border: 1px solid #334155; border-radius: 12px; overflow: hidden; background: #020617; }
        .log-header { padding: 15px; background: #1e293b; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; }
        .log-table-wrapper { overflow-x: auto; max-height: 600px; }
        .log-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .log-table th, .log-table td { padding: 14px; text-align: left; border-bottom: 1px solid #1e293b; }
        .log-table th { background: #0f172a; color: #94a3b8; font-weight: 600; position: sticky; top: 0; z-index: 10; }
        .log-row:hover { background: rgba(59, 130, 246, 0.05); }
        .log-time { color: #64748b; font-size: 0.8rem; font-family: monospace; white-space: nowrap; }
        .log-location { color: var(--accent); font-weight: 600; font-size: 0.85rem; }
        .badge-file { background: #334155; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; text-decoration: none; margin-left: 5px; display: inline-block; }
        .badge-file:hover { background: var(--accent); }

        /* --- RESPONSIVE --- */
        .mobile-menu-btn { display: none; background: transparent; border: none; color: white; font-size: 1.8rem; cursor: pointer; }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: 85%; max-width: 320px; transform: translateX(-100%); box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 40; backdrop-filter: blur(3px); }
            .sidebar-overlay.active { display: block; }
            .mobile-menu-btn { display: block; }
            .main { padding: 10px; }
            .top-bar { flex-direction: column; align-items: flex-start; }
            .top-bar > div { width: 100%; }
            .top-bar .btn-group { justify-content: flex-end; }
        }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-content { background: var(--card); padding: 30px; border-radius: 16px; width: 95%; max-width: 500px; position: relative; border: 1px solid #475569; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #94a3b8; }
        .close-btn:hover { color: white; }

        /* --- UTILS --- */
        .row { display: flex; gap: 15px; flex-wrap: wrap; } .col { flex: 1; min-width: 240px; }
        .voice-timer { font-size: 1.1rem; font-weight: 700; color: var(--success); background: rgba(34, 197, 94, 0.1); padding: 8px 16px; border-radius: 8px; border: 1px solid rgba(34, 197, 94, 0.2); display: inline-block; }
    </style>
</head>
<body>

<div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

<div id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <span>ü§ñ ULTIMATE BOT</span>
        <button onclick="toggleSidebar()" class="mobile-menu-btn">√ó</button>
    </div>
    <div style="padding: 10px;">
        <button class="sidebar-btn btn-add" onclick="createAccount()">+ Th√™m Bot M·ªõi</button>
        <button class="sidebar-btn btn-settings" onclick="openSystemSettings()">‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</button>
    </div>
    <div id="accountList" class="account-list"></div>
    <div style="padding: 10px;">
        <button class="sidebar-btn btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>
</div>

<div class="main">
    <div style="display: flex; align-items: center; margin-bottom: 15px; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <h3 style="margin:0; font-size: 1.1rem; color: #94a3b8;" id="mobileHeaderTitle">Dashboard</h3>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display:none;">
        
        <div class="top-bar">
            <div style="flex: 1; min-width: 0;">
                <h1 id="displayBotName" style="margin:0; font-size: 1.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Bot Name</h1>
                <div style="color:#64748b; font-family: monospace; margin-top: 5px;" id="displayBotId">ID: ...</div>
            </div>
            <div class="btn-group" style="display:flex; gap:10px; align-items: center;">
                <button id="powerBtn" class="power-btn" onclick="togglePower()">Loading...</button>
                <button class="btn btn-danger" onclick="deleteAccount()" title="X√≥a Bot">üóëÔ∏è</button>
            </div>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="showTab('rpc')">üé® RPC Status</button>
            <button class="nav-btn" onclick="showTab('voice')">üé§ Voice & Cam</button>
            <button class="nav-btn" onclick="showTab('logging')">üìú Message Logs</button>
            <button class="nav-btn" onclick="showTab('tools')">üõ†Ô∏è Tools</button>
            <button class="nav-btn" onclick="showTab('general')">‚öôÔ∏è Config</button>
        </div>

        <div id="rpc" class="section active">
            <div class="card">
                <div class="switch-row">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:1.2rem;">üü¢</span>
                        <div>
                            <div style="font-weight:bold;">B·∫≠t RPC</div>
                            <small style="color:#94a3b8;">Hi·ªÉn th·ªã tr·∫°ng th√°i ho·∫°t ƒë·ªông gi·∫£</small>
                        </div>
                    </div>
                    <input type="checkbox" id="enabled">
                </div>
                
                <div class="row">
                    <div class="col">
                        <label>Lo·∫°i ho·∫°t ƒë·ªông</label>
                        <select id="type">
                            <option value="PLAYING">Playing (ƒêang ch∆°i)</option>
                            <option value="STREAMING">Streaming (ƒêang live)</option>
                            <option value="LISTENING">Listening (ƒêang nghe)</option>
                            <option value="WATCHING">Watching (ƒêang xem)</option>
                            <option value="COMPETING">Competing (Thi ƒë·∫•u)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>T√™n hi·ªÉn th·ªã (D√≤ng 1)</label>
                        <input type="text" id="name" placeholder="V√≠ d·ª•: Visual Studio Code">
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label>Chi ti·∫øt (D√≤ng 2 - Animated)</label>
                        <input type="text" id="details" placeholder="D√πng d·∫•u | ƒë·ªÉ ƒë·ªïi status. VD: Ng·ªß | ƒÇn | Ch∆°i">
                    </div>
                    <div class="col">
                        <label>Tr·∫°ng th√°i (D√≤ng 3)</label>
                        <input type="text" id="state" placeholder="V√≠ d·ª•: ƒêang code d·∫°o...">
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label>Large Image (URL/Key)</label>
                        <input type="text" id="largeImage">
                        <input type="text" id="largeText" placeholder="Text khi tr·ªè chu·ªôt v√†o" style="margin-top:5px">
                    </div>
                    <div class="col">
                        <label>Small Image (URL/Key)</label>
                        <input type="text" id="smallImage">
                        <input type="text" id="smallText" placeholder="Text khi tr·ªè chu·ªôt v√†o" style="margin-top:5px">
                    </div>
                </div>

                <div style="background: #0f172a; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #334155;">
                    <label style="margin-top:0">üîò C√°c n√∫t b·∫•m (Buttons)</label>
                    <div class="row">
                        <div class="col"><input type="text" id="button1Label" placeholder="T√™n N√∫t 1"><input type="text" id="button1URL" placeholder="Link N√∫t 1"></div>
                        <div class="col"><input type="text" id="button2Label" placeholder="T√™n N√∫t 2"><input type="text" id="button2URL" placeholder="Link N√∫t 2"></div>
                    </div>
                </div>

                <div style="margin-top:15px;">
                    <label>Application ID (Optional)</label>
                    <input type="text" id="applicationId" placeholder="Ch·ªâ nh·∫≠p n·∫øu d√πng Asset Key t·ª´ Developer Portal">
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">üíæ L∆∞u C·∫•u H√¨nh RPC</button>
            </div>
        </div>

        <div id="voice" class="section">
            <div class="card">
                <div class="switch-row">
                    <div>
                        <div style="font-weight:bold;">üîä Auto Join Voice</div>
                        <small style="color:#94a3b8;">T·ª± ƒë·ªông v√†o k√™nh voice khi ch·∫°y</small>
                    </div>
                    <input type="checkbox" id="voiceEnabled">
                </div>

                <div class="row">
                    <div class="col"><label>Guild ID (ID Server)</label><input type="text" id="voiceGuildId"></div>
                    <div class="col"><label>Channel ID (ID K√™nh)</label><input type="text" id="voiceChannelId"></div>
                </div>

                <div class="switch-row" style="margin-top:15px;">
                    <div>
                        <div style="font-weight:bold;">üìπ Camera ·∫£o</div>
                        <small style="color:#94a3b8;">B·∫≠t camera khi v√†o voice (Gi·∫£ l·∫≠p)</small>
                    </div>
                    <input type="checkbox" id="voiceVideo">
                </div>

                <div id="voiceTimerContainer" style="display:none; text-align: center; margin-top: 20px;">
                    <div class="voice-timer">‚è±Ô∏è ƒêang treo: <span id="voiceTimer">00:00:00</span></div>
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">üíæ L∆∞u C·∫•u H√¨nh Voice</button>
            </div>
        </div>

        <div id="logging" class="section">
            <div class="card">
                <div class="switch-row">
                    <div>
                        <div style="font-weight:bold;">üî¥ Ghi Log Tin Nh·∫Øn</div>
                        <small style="color:#94a3b8;">L∆∞u tin nh·∫Øn v√†o file & hi·ªÉn th·ªã b√™n d∆∞·ªõi</small>
                    </div>
                    <input type="checkbox" id="logEnabled">
                </div>
                
                <div class="row">
                    <div class="col">
                        <label>Theo d√µi Server (ID c√°ch nhau d·∫•u ph·∫©y)</label>
                        <input type="text" id="logGuilds" placeholder="VD: 123456789, 987654321">
                        <small style="color:#64748b">Ghi t·∫•t c·∫£ k√™nh trong server n√†y</small>
                    </div>
                    <div class="col">
                        <label>Theo d√µi K√™nh L·∫ª (ID c√°ch nhau d·∫•u ph·∫©y)</label>
                        <input type="text" id="logChannels" placeholder="VD: 111222333, 444555666">
                        <small style="color:#64748b">Ch·ªâ ghi k√™nh c·ª• th·ªÉ n√†y</small>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveConfig()">üíæ L∆∞u C·∫•u H√¨nh Log</button>
            </div>

            <div class="log-container">
                <div class="log-header">
                    <h4 style="margin:0; display:flex; align-items:center; gap:10px;">
                        üìú Nh·∫≠t K√Ω <span style="font-size:0.8rem; background:#334155; padding:2px 8px; border-radius:10px; color:#cbd5e1">50 tin m·ªõi nh·∫•t</span>
                    </h4>
                    <div style="display:flex; gap:8px">
                        <button class="btn btn-info" style="padding:8px 14px;" onclick="fetchHistory()">üîç L·ªãch s·ª≠ c≈©</button>
                        <button class="btn btn-secondary" style="padding:8px 14px;" onclick="loadMessageLogs()">üîÑ T·∫£i l·∫°i</button>
                        <button class="btn btn-danger" style="padding:8px 14px;" onclick="clearMessageLogs()">üóëÔ∏è X√≥a</button>
                    </div>
                </div>
                <div class="log-table-wrapper">
                    <table class="log-table">
                        <thead>
                            <tr>
                                <th style="width: 140px">Th·ªùi gian</th>
                                <th style="width: 180px">Ng∆∞·ªùi g·ª≠i</th>
                                <th>N·ªôi dung</th>
                                <th style="width: 160px">V·ªã tr√≠</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <tr><td colspan="4" style="text-align:center; padding: 30px; color:#64748b;">Nh·∫•n "T·∫£i l·∫°i" ƒë·ªÉ xem d·ªØ li·ªáu...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tools" class="section">
            <div class="card" style="border-left: 4px solid var(--danger);">
                <h3 style="margin-top:0; color: var(--danger);">üóëÔ∏è Purge Messages (X√≥a tin nh·∫Øn)</h3>
                <p style="color:#94a3b8; font-size: 0.95rem; line-height: 1.5;">
                    C√¥ng c·ª• n√†y gi√∫p b·∫°n x√≥a tin nh·∫Øn c·ªßa <b>CH√çNH M√åNH</b> trong m·ªôt k√™nh c·ª• th·ªÉ.<br>
                    <i>L∆∞u √Ω: Selfbot kh√¥ng th·ªÉ x√≥a tin nh·∫Øn c·ªßa ng∆∞·ªùi kh√°c.</i>
                </p>
                
                <div class="row">
                    <div class="col">
                        <label>Channel ID (K√™nh c·∫ßn x√≥a)</label>
                        <input type="text" id="purgeChannelId" placeholder="Nh·∫≠p ID k√™nh chat...">
                    </div>
                    <div class="col">
                        <label>S·ªë l∆∞·ª£ng (T·ªëi ƒëa 100)</label>
                        <input type="number" id="purgeAmount" value="10" min="1" max="100">
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="purgeMessages()" style="margin-top:15px; width: auto;">üöÄ B·∫Øt ƒë·∫ßu x√≥a</button>
            </div>
        </div>

        <div id="general" class="section">
            <div class="card">
                <h3 style="margin-top:0">C·∫•u h√¨nh chung</h3>
                <div class="row">
                    <div class="col">
                        <label>T√™n Bot (Qu·∫£n l√Ω)</label>
                        <input type="text" id="botNameConfig">
                    </div>
                    <div class="col">
                        <label>Thi·∫øt b·ªã</label>
                        <select id="deviceType">
                            <option value="desktop">Desktop (PC)</option>
                            <option value="mobile">Mobile (ƒêi·ªán tho·∫°i)</option>
                            <option value="web">Web Browser</option>
                        </select>
                    </div>
                </div>
                
                <label style="color:var(--warning)">Token (B·∫Øt bu·ªôc)</label>
                <input type="password" id="token" placeholder="Nh·∫≠p User Token...">
                
                <div style="margin-top:25px; border-top:1px solid #334155; padding-top:15px;">
                    <h4 style="margin-top:0">üí¨ Auto Chat (Spam)</h4>
                    <div class="switch-row"><span>B·∫≠t Auto Chat</span><input type="checkbox" id="autoChatEnabled"></div>
                    
                    <div class="row">
                         <div class="col"><label>K√™nh ID</label><input type="text" id="autoChatChannelId"></div>
                         <div class="col"><label>Kho·∫£ng c√°ch (Gi√¢y)</label><input type="number" id="autoChatInterval" value="5"></div>
                    </div>
                    
                    <label>N·ªôi dung (M·ªói c√¢u 1 d√≤ng)</label>
                    <textarea id="autoChatContent" rows="5" placeholder="Nh·∫≠p n·ªôi dung..."></textarea>
                </div>

                <div style="margin-top:25px; border-top:1px solid #334155; padding-top:15px;">
                    <h4 style="margin-top:0">üí§ AFK Auto Reply</h4>
                    <div class="switch-row"><span>B·∫≠t AFK Reply</span><input type="checkbox" id="afkEnabled"></div>
                    <label>Tin nh·∫Øn ph·∫£n h·ªìi</label>
                    <input type="text" id="afkMessage" value="T√¥i ƒëang b·∫≠n, s·∫Ω tr·∫£ l·ªùi sau.">
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">üíæ L∆∞u T·∫•t C·∫£ C·∫•u H√¨nh</button>
            </div>
        </div>

    </div>
    
    <div id="welcomeMsg" style="text-align:center; margin-top:80px; color:#64748b; padding: 20px;">
        <div style="font-size: 4rem; margin-bottom: 20px;">ü§ñ</div>
        <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Ultimate Manager</h1>
        <p>Vui l√≤ng ch·ªçn Bot t·ª´ menu b√™n tr√°i ho·∫∑c th√™m Bot m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
    </div>
</div>

<div id="systemModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('systemModal').style.display='none'">&times;</span>
        <h3 style="margin-top:0">‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</h3>
        <p style="color:#94a3b8; font-size:0.9rem;">C·∫•u h√¨nh Webhook ƒë·ªÉ nh·∫≠n th√¥ng b√°o khi Bot b·ªã l·ªói ho·∫∑c c√≥ ng∆∞·ªùi tag.</p>
        
        <label>Webhook URL</label>
        <input type="text" id="sysWebhook" placeholder="https://discord.com/api/webhooks/...">
        
        <div style="display:flex; gap:10px; margin-top:20px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="saveSystemSettings(true)">L∆∞u & Test</button>
            <button class="btn btn-primary" style="width:auto; margin-top:0;" onclick="saveSystemSettings(false)">L∆∞u l·∫°i</button>
        </div>
    </div>
</div>

<script>
    let currentAccountId = null;
    let currentBotRunning = false;
    let voiceJoinTime = null;
    let timerInterval = null;
    let pollInterval = null;

    // --- DATA MAPPING ---
    const inputs = [
        'token','name','type','details','state','largeImage','largeText','smallImage','smallText',
        'button1Label','button1URL','button2Label','button2URL',
        'voiceGuildId','voiceChannelId','autoChatChannelId','autoChatContent','autoChatInterval', 
        'deviceType', 'applicationId', 'afkMessage',
        'logGuilds', 'logChannels' 
    ];
    const checks = ['enabled','voiceEnabled','voiceVideo','autoChatEnabled','afkEnabled', 'logEnabled'];

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebarOverlay').classList.toggle('active'); }

    // --- MAIN LOGIC ---
    async function loadAccounts() {
        const res = await fetch('/api/accounts');
        if(res.status === 401) return window.location.href = '/login.html';
        const list = await res.json();
        
        document.getElementById('accountList').innerHTML = list.map(bot => `
            <div class="account-item ${bot.id === currentAccountId ? 'active' : ''}" onclick="selectAccount('${bot.id}')">
                <div class="acc-avatar">
                    ${bot.avatar ? `<img src="${bot.avatar}">` : bot.name.substring(0,2).toUpperCase()}
                </div>
                <div class="acc-info">
                    <div class="acc-name">${bot.name}</div>
                    <div class="acc-status">
                        <span class="status-dot ${bot.isRunning ? 'dot-green' : 'dot-red'}"></span> 
                        ${bot.isRunning ? 'Online' : 'Offline'}
                    </div>
                </div>
            </div>`).join('');
        
        // C·∫≠p nh·∫≠t realtime tr·∫°ng th√°i
        if(currentAccountId) {
            const currentBot = list.find(b => b.id === currentAccountId);
            if(currentBot) {
                if(currentBot.isRunning !== currentBotRunning) {
                    currentBotRunning = currentBot.isRunning;
                    updatePowerBtn();
                    if(currentBotRunning) {
                        const detailRes = await fetch(`/api/accounts/${currentAccountId}`);
                        const detailData = await detailRes.json();
                        voiceJoinTime = detailData.voiceJoinedAt;
                        startVoiceTimer();
                    } else { startVoiceTimer(); }
                }
            }
        }
    }

    async function createAccount() { 
        if(confirm("T·∫°o m·ªôt bot m·ªõi?")) { 
            await fetch('/api/accounts/create', { method: 'POST' }); 
            loadAccounts(); 
        } 
    }

    async function selectAccount(id) {
        currentAccountId = id;
        document.getElementById('welcomeMsg').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';
        if(window.innerWidth <= 768) {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }

        // Reset Form
        inputs.forEach(k => { const el = document.getElementById(k); if(el) el.value = ''; });
        checks.forEach(k => { const el = document.getElementById(k); if(el) el.checked = false; });

        loadAccounts();
        const res = await fetch(`/api/accounts/${id}`);
        const data = await res.json();
        
        // Fill Header Info
        document.getElementById('displayBotName').innerText = data.name || 'Unnamed Bot';
        document.getElementById('displayBotId').innerText = 'ID: ' + id;
        document.getElementById('botNameConfig').value = data.name || '';
        
        // Fill Inputs
        inputs.forEach(k => { if(document.getElementById(k)) document.getElementById(k).value = data[k] || ''; });
        checks.forEach(k => { if(document.getElementById(k)) document.getElementById(k).checked = !!data[k]; });

        currentBotRunning = data.isRunning;
        voiceJoinTime = data.voiceJoinedAt;
        updatePowerBtn();
        startVoiceTimer();
        loadMessageLogs(); // Load log ngay

        if(pollInterval) clearInterval(pollInterval);
        pollInterval = setInterval(loadAccounts, 3000); 
    }

    async function saveConfig() {
        if(!currentAccountId) return;
        const data = {};
        inputs.forEach(k => { const el = document.getElementById(k); if(el) data[k] = el.value; });
        checks.forEach(k => { const el = document.getElementById(k); if(el) data[k] = el.checked; });
        
        try {
            await fetch(`/api/accounts/${currentAccountId}/config`, { 
                method: 'POST', headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify(data) 
            });
            alert('‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh th√†nh c√¥ng!');
            selectAccount(currentAccountId);
        } catch(e) { alert('‚ùå L·ªói khi l∆∞u c·∫•u h√¨nh!'); }
    }

    async function togglePower() {
        if(!currentAccountId) return;
        const action = currentBotRunning ? 'stop' : 'start';
        const btn = document.getElementById('powerBtn');
        btn.innerText = 'ƒêang x·ª≠ l√Ω...';
        
        // L·∫•y config hi·ªán t·∫°i tr√™n form ƒë·ªÉ start ngay (tr√°nh vi·ªác qu√™n b·∫•m save)
        const tempConfig = {};
        if (action === 'start') {
            inputs.forEach(k => { const el = document.getElementById(k); if(el) tempConfig[k] = el.value; });
            checks.forEach(k => { const el = document.getElementById(k); if(el) tempConfig[k] = el.checked; });
        }

        try {
            const res = await fetch(`/api/accounts/${currentAccountId}/power`, { 
                method: 'POST', headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ action, tempConfig }) 
            });
            const data = await res.json();
            
            if (action === 'start' && !data.isRunning) alert(data.message || "‚ùå L·ªói kh·ªüi ƒë·ªông! Ki·ªÉm tra Token.");
            currentBotRunning = data.isRunning;
            updatePowerBtn();
            loadAccounts();
        } catch(e) { alert("‚ùå M·∫•t k·∫øt n·ªëi t·ªõi server!"); }
    }

    function updatePowerBtn() { 
        const btn = document.getElementById('powerBtn'); 
        if(currentBotRunning) { 
            btn.className = 'power-btn power-on'; 
            btn.innerText = '‚è∫ ƒêANG CH·∫†Y'; 
        } else { 
            btn.className = 'power-btn power-off'; 
            btn.innerText = '‚èπ ƒê√É T·∫ÆT'; 
        } 
    }

    // --- LOGGING FUNCTIONS ---
    async function loadMessageLogs() {
        if(!currentAccountId) return;
        const tbody = document.getElementById('logTableBody');
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>';
        
        try {
            const res = await fetch(`/api/logs/${currentAccountId}`);
            const logs = await res.json();
            
            if(!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px; color:#64748b;">Ch∆∞a c√≥ log. H√£y b·∫≠t "Ghi Log" v√† nh·∫≠p ƒë√∫ng ID Server/Channel.</td></tr>';
                return;
            }

            renderLogs(logs, tbody);
        } catch(e) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#ef4444">‚ùå L·ªói t·∫£i d·ªØ li·ªáu!</td></tr>'; }
    }

    async function fetchHistory() {
        if(!currentAccountId || !currentBotRunning) return alert("‚ö†Ô∏è Bot ph·∫£i ƒëang Online m·ªõi c√≥ th·ªÉ soi tin nh·∫Øn c≈©!");
        
        const channelId = prompt("Nh·∫≠p ID K√™nh (Channel ID) mu·ªën xem l·ªãch s·ª≠:");
        if (!channelId) return;

        const tbody = document.getElementById('logTableBody');
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">üì° ƒêang k·∫øt n·ªëi Discord ƒë·ªÉ t·∫£i tin c≈©...</td></tr>';

        try {
            const res = await fetch(`/api/history/${currentAccountId}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ channelId })
            });
            const result = await res.json();

            if (!result.success) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; color:#ef4444">‚ùå ${result.error}</td></tr>`;
                return;
            }
            if (result.data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">K√™nh n√†y tr·ªëng tr∆°n.</td></tr>';
                return;
            }

            renderLogs(result.data, tbody, true); // True = highlight mode
            alert("‚úÖ ƒê√£ t·∫£i xong l·ªãch s·ª≠ tin nh·∫Øn!");

        } catch (e) {
            alert("‚ùå L·ªói k·∫øt n·ªëi!");
            loadMessageLogs();
        }
    }

    function renderLogs(logs, tbody, isHistory = false) {
        tbody.innerHTML = logs.map(log => {
            const attachHtml = log.attachments && log.attachments.length > 0 
                ? log.attachments.map(url => `<a href="${url}" target="_blank" class="badge-file">üìé FILE</a>`).join(' ') : '';
            
            const rowStyle = isHistory ? 'background: rgba(14, 165, 233, 0.08);' : '';

            return `
            <tr class="log-row" style="${rowStyle}">
                <td><span class="log-time">${log.time}</span></td>
                <td>
                    <div style="display:flex; align-items:center">
                        <img src="${log.authorAvatar}" class="log-avatar" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'" style="width:24px; height:24px; border-radius:50%; margin-right:8px;">
                        <span style="font-weight:600; overflow:hidden; text-overflow:ellipsis; max-width:140px;">${log.author}</span>
                    </div>
                </td>
                <td style="word-break:break-word; min-width: 250px; line-height: 1.4;">
                    ${log.content.replace(/</g, '&lt;')} ${attachHtml}
                </td>
                <td><span class="log-location">${log.location}</span></td>
            </tr>`;
        }).join('');
    }

    async function clearMessageLogs() {
        if(!currentAccountId || !confirm('‚ùì B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA H·∫æT nh·∫≠t k√Ω tin nh·∫Øn c·ªßa bot n√†y?')) return;
        await fetch(`/api/logs/${currentAccountId}`, { method: 'DELETE' });
        loadMessageLogs();
    }

    // --- PURGE TOOL ---
    async function purgeMessages() {
        if(!currentAccountId || !currentBotRunning) return alert("‚ö†Ô∏è Bot ph·∫£i ƒëang Online m·ªõi x√≥a ƒë∆∞·ª£c tin nh·∫Øn!");
        const channelId = document.getElementById('purgeChannelId').value;
        const amount = document.getElementById('purgeAmount').value;
        
        if(!channelId) return alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p Channel ID!");
        
        const btn = event.target;
        const oldText = btn.innerText;
        btn.innerText = "‚è≥ ƒêang x√≥a..."; btn.disabled = true;

        try {
            const res = await fetch(`/api/accounts/${currentAccountId}/purge`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ channelId, amount: parseInt(amount) })
            });
            const data = await res.json();
            if(data.success) alert(`‚úÖ ƒê√£ x√≥a th√†nh c√¥ng ${data.deleted} tin nh·∫Øn!`);
            else alert(`‚ùå L·ªói: ${data.error}`);
        } catch(e) { alert("‚ùå L·ªói k·∫øt n·ªëi!"); }
        
        btn.innerText = oldText; btn.disabled = false;
    }

    // --- UTILS ---
    function startVoiceTimer() {
        if (timerInterval) clearInterval(timerInterval);
        const container = document.getElementById('voiceTimerContainer');
        const timerEl = document.getElementById('voiceTimer');
        
        if (!voiceJoinTime || !currentBotRunning) { 
            container.style.display = 'none'; 
            return; 
        }
        
        container.style.display = 'block';
        timerInterval = setInterval(() => {
            const diff = Date.now() - voiceJoinTime;
            const s = Math.floor((diff / 1000) % 60);
            const m = Math.floor((diff / (1000 * 60)) % 60);
            const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            let timeStr = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if (d > 0) timeStr = `${d}d ${timeStr}`;
            
            timerEl.innerText = timeStr;
        }, 1000);
    }

    async function openSystemSettings() {
        const res = await fetch('/api/system');
        const data = await res.json();
        document.getElementById('sysWebhook').value = data.webhookUrl || '';
        document.getElementById('systemModal').style.display = 'flex';
        if(window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('open');
    }

    async function saveSystemSettings(test) {
        const url = document.getElementById('sysWebhook').value;
        await fetch('/api/system', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ webhookUrl: url, test: test }) });
        alert(test ? '‚úÖ ƒê√£ l∆∞u v√† g·ª≠i tin test!' : '‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t!');
        if(!test) document.getElementById('systemModal').style.display = 'none';
    }

    async function deleteAccount() { 
        if(confirm("‚ö†Ô∏è C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn bot n√†y v√† to√†n b·ªô log?")) { 
            await fetch(`/api/accounts/${currentAccountId}`, { method: 'DELETE' }); 
            location.reload(); 
        } 
    }
    
    async function logout() { await fetch('/api/logout', { method: 'POST' }); location.href = '/login.html'; }
    
    function showTab(id) { 
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); 
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
        event.currentTarget.classList.add('active'); 
    }
    
    // START APP
    loadAccounts();
</script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c6d2378fa3ad096',t:'MTc2OTkwMzcxMg=='};var a=document.createElement('script');a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
